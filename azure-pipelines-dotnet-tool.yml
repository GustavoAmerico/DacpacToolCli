variables:
  versionBase: '1.1'
  tool_version: $(versionBase).$(Build.BuildId)

trigger:
  branches:
    include:
     - master 
  paths:
    include:
     - 'src/DacpacToolSolution/*'
     - 'azure-pipelines-dotnet-tool.yml'
     
name: $(versionBase).$(Build.BuildId)

jobs:
  - job: BUILD
    displayName: Generate Nuget package
    pool: 
      vmImage: ubuntu-latest      
    steps:
    - task: DotNetCoreCLI@2
      inputs:
        command: 'pack'
        packagesToPack: 'Dacpac.Tool'
        packDirectory: '$(Build.ArtifactStagingDirectory)\artifact'
        includesymbols: true
        versioningScheme: 'Off'
        buildProperties: 'PackageVersion=$(tool_version)'
        verbosityPack: 'Normal'
        workingDirectory: src/DacpacToolSolution/
    
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact'
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)\artifact'
    